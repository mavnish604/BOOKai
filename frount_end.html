<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Recommender</title>
    <!-- 1. Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 2. React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- 3. Babel to translate JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen">

    <!-- The root element where our React app will be mounted -->
    <div id="root" class="w-full max-w-2xl px-4"></div>

    <!-- The React application code -->
    <script type="text/babel">

        const App = () => {
            // --- State Management ---
            // Holds the user's input text
            const [prompt, setPrompt] = React.useState("");
            // Stores the list of recommended books from the API
            const [recommendations, setRecommendations] = React.useState([]);
            // Stores the original book title the recommendations are for
            const [sourceBookTitle, setSourceBookTitle] = React.useState("");
            // Manages the loading state to show a spinner
            const [isLoading, setIsLoading] = React.useState(false);
            // Stores any error messages
            const [error, setError] = React.useState(null);

            // --- API Call Function ---
            const getRecommendations = async () => {
                // Don't do anything if the input is empty
                if (!prompt.trim()) return;

                // Reset state and start loading
                setIsLoading(true);
                setError(null);
                setRecommendations([]);
                setSourceBookTitle("");

                try {
                    // Make a POST request to your FastAPI backend
                    // IMPORTANT: The backend must be running on this address
                    const response = await fetch("http://127.0.0.1:8001/recommend", {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ prompt: prompt }),
                    });

                    if (!response.ok) {
                        // If the server response is not okay, try to parse the error detail
                        const errorData = await response.json();
                        throw new Error(errorData.detail || `HTTP error! Status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    setRecommendations(data.recommendations);
                    setSourceBookTitle(data.source_book_title);

                } catch (err) {
                    console.error("Fetch error:", err);
                    setError(err.message);
                } finally {
                    // Stop loading regardless of success or failure
                    setIsLoading(false);
                }
            };

            const handleSubmit = (e) => {
                e.preventDefault(); // Prevents the browser from reloading the page
                getRecommendations();
            };
            
            // --- UI Rendering ---
            return (
                <div className="bg-gray-800 rounded-xl shadow-2xl p-6 sm:p-8 border border-gray-700">
                    <div className="text-center mb-8">
                        <h1 className="text-3xl sm:text-4xl font-bold text-cyan-400">AI Book Recommender</h1>
                        <p className="text-gray-400 mt-2">Enter a book you liked, and we'll find your next great read.</p>
                    </div>

                    <form onSubmit={handleSubmit}>
                        <div className="flex flex-col sm:flex-row gap-3">
                            <input
                                type="text"
                                value={prompt}
                                onChange={(e) => setPrompt(e.target.value)}
                                placeholder="e.g., I loved 'The Martian' by Andy Weir"
                                className="w-full bg-gray-700 text-white rounded-md px-4 py-3 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-cyan-500 transition duration-300"
                                disabled={isLoading}
                            />
                            <button
                                type="submit"
                                className="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 px-6 rounded-md transition duration-300 disabled:bg-gray-500 disabled:cursor-not-allowed flex items-center justify-center"
                                disabled={isLoading}
                            >
                                {isLoading ? (
                                    <svg className="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                ) : "Recommend"}
                            </button>
                        </div>
                    </form>

                    <div className="mt-8 min-h-[200px]">
                        {error && (
                            <div className="bg-red-900/50 border border-red-700 text-red-300 px-4 py-3 rounded-md text-center">
                                <p><span className="font-bold">Error:</span> {error}</p>
                            </div>
                        )}

                        {recommendations.length > 0 && (
                            <div className="animate-fade-in">
                                <h2 className="text-xl font-semibold mb-4 text-center">
                                    Because you liked <span className="text-cyan-400 font-bold">"{sourceBookTitle}"</span>...
                                </h2>
                                <ul className="space-y-3">
                                    {recommendations.map((book, index) => (
                                        <li key={index} className="bg-gray-700/50 p-4 rounded-md border border-gray-600 transition duration-300 hover:bg-gray-700/80 hover:border-cyan-500">
                                            <p className="text-lg text-gray-200">{book.title}</p>
                                        </li>
                                    ))}
                                </ul>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Render the App component into the #root div
        ReactDOM.render(<App />, document.getElementById('root'));

    </script>
</body>
</html>
